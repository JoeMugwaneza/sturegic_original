<% if current_user.admin == true %>
<script type="text/javascript" src="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>

<div class="container col-md-12" style="margin-top: 50px;">

  <!-- main column -->
  <div class="col-md-8 col-xs-12">
    <!-- all Students -->
    <div id="admintable">
      <h2 class="text-center thead">All Students</h2>
      <table class="table" id="test">
        <a class="btn btn-register pull-right" href="/signup">Register a Student</a>     
        <thead class="thead">
          <tr>
            <th>N<sup>o</sup></th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Country</th>
            <th>District</th>
            <th>Program</th>
            <th>Course</th>
            <th>Status</th>
            <th>Application</th>
          </tr>
        </thead>
        <tbody>
          <% @students.each do |student| %>
          <% @table_number += 1 %>
          <tr>
            <td><%= @table_number %></td>
            <td><a href="/students/<%= student.friendly_id %>"><%= student.first_name %></a></td>
            <td><%= student.last_name %></td>
            <td><%= student.country.name%></td>
            <% if student.studentInfo%>
            <td>
              <% if student.studentInfo.district%>
              <%= student.studentInfo.district.name%>
              <% else %>
              <%= student.studentInfo.city%>
              <% end %> 
            </td>
            <td><%= student.studentInfo.program_category.name%></td>
            <td><%= student.studentInfo.course.name%></td>
            <% if student.studentInfo.status == true %>
            <td>Approved</td>
            <% else %>
            <td>Pending</td>
            <% end %>
            <td>Submitted</td>
            <% else %>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td><a href="/student_infos/new?student_id=<%=student.id%>"><small>Complete Registration</small></a></td>
            <% end %>
          </tr>
          <% end %>
        </tbody>
      </table>

    </div>

    <!-- Admins -->

    <div class="col-md-12 thumbnail" style="margin-top: 10px; margin-right: 30px;">
      <h2 class="text-center">Admins</h2>
      <table class="table table-hover">
        <thead>

          <tr>
            <th>Name</th>
            <th>Country</th>
            <!-- <th>District/City</th> -->
            <th>Students</th>
          </tr>
        </thead>
        <tbody>
          <% @admins.each do |admin| %>
          <tr>
            <td><%= admin.first_name %> <%= admin.last_name %></td>
            <td><%= admin.country.name %></td>
            <!-- <td>Kigali</td> -->
            <td><%= admin.studentInfos.count %></td>
            <td><a class="btn btn-register pull-right" href="#">Remove</a></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>


    <!-- agents -->
    <div class="col-md-12 thumbnail" style="margin-right: 30px;">
      <h2 class="text-center">Agents</h2>
      <table class="table table-hover">
        <thead>

          <tr>
            <th>Name</th>
            <th>Country</th>
            <!-- <th>District/City</th> -->
            <th>Students</th>
          </tr>
        </thead>
        <tbody>
          <% @agents.each do |agent| %>
          <tr>
            <td><%= agent.first_name %> <%= agent.last_name %></td> 
            <td><%= agent.country.name%></td> 
            <!-- <td>Musanze</td> -->
            <td><%= agent.studentInfos.count%></td> 
            <td><a class="btn btn-register pull-right" href="/student_infos?agent_rm=<%= agent.id %>">Remove</a></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  </div>


  <!-- side column -->
  <div class="col-md-4">
    <!-- pending applications -->
    <div class="col-md-12" id="admintable">
      <h2 class="text-center">Pending Applications</h2>
      <div class="tbody">
        <table class="table sidetable" id="test">
          <thead class="thead">
            <tr>
              <th>N<sup>o</sup></th>      
              <th>Name</th>
              <th class="pull-right">view</th>
            </tr>
          </thead>
          <tbody>
            <% n = 1 %>
            <% @studentInfos.each do |studentInfo| %>
              <tr>
                <td><%= n %></td>     
                <td><%= studentInfo.student.first_name %><%= studentInfo.student.last_name %></td>
                <td><a href="students/<%= studentInfo.student.friendly_id %>/profile-one" class="btn btn-register pull-right">View</a></td> 
                <% n +=1 %>           
              </tr>
            <%end%>
          </tbody>
        </table>
      </div>
    </div>

    <!-- monthly commission details -->
    <div class="col-md-12" id="admintable">
      <h2 class="text-center">Monthly Commission Details</h2>
      <div class="tbody">
        <table class="table sidetable" id="test">
          <thead class="thead">
            <tr>      
              <th>Name</th>
              <th>Commission Received</th>
              <th>Reward</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
          <% @students.each do |student|%>
            <% if student.studentInfos.any? %>
              <% if student.technicalgroups.any? %>
                <% tech_sum = 0 %>
                <% student.technicalgroups.each do |group|%>
                  <% tech_sum += ((student.level_one(student.technicalgroups.index(group),"technical").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 5000) + (student.level_two(student.technicalgroups.index(group),"technical").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 4000) + (student.level_three(student.technicalgroups.index(group),"technical").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 3000) + (student.level_four(student.technicalgroups.index(group),"technical").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 2000)+ (student.level_five(student.technicalgroups.index(group),"technical").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000))%>
                <% end %>  
              <% end %>
              <% if student.languagesgroups.any? %>
                <% lang_sum = 0 %>
                <% student.languagesgroups.each do |group|%>
                  <% lang_sum += ((student.level_one(student.languagesgroups.index(group),"languages").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 2000) + (student.level_two(student.languagesgroups.index(group),"languages").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000) + (student.level_three(student.languagesgroups.index(group),"languages").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000) + (student.level_four(student.languagesgroups.index(group),"languages").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000)+ (student.level_five(student.languagesgroups.index(group),"languages").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000))%>
                <% end %>  
              <% end %>
              <% if student.trafficgroups.any? %>
                <% traffic_sum = 0 %>
                <% student.trafficgroups.each do |group|%>
                  <% traffic_sum += ((student.level_one(student.trafficgroups.index(group),"Traffic").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 2000) + (student.level_two(student.trafficgroups.index(group),"Traffic").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000) + (student.level_three(student.trafficgroups.index(group),"Traffic").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000) + (student.level_four(student.trafficgroups.index(group),"Traffic").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000)+ (student.level_five(student.trafficgroups.index(group),"Traffic").select{|student| Time.now.beginning_of_month <= student.created_at && Time.now.end_of_month >= student.created_at}.count * 1000))%>
                <% end %>
              <% end %>
              <% if (tech_sum.to_i + lang_sum.to_i + traffic_sum.to_i) != 0 %>      
                <tr>
                  <td><%= student.first_name %></td>
                  <td>
                    <%= tech_sum.to_i + lang_sum.to_i + traffic_sum.to_i %>
                  </td>
                  <td><a href="/students/<%= student.friendly_id %>">View Reward</a></td>
                  <td><%= student.created_at %></td>
                </tr>
              <% end %>
            <% end %>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<% elsif current_user.agent == true %>
<div class="container">
  <div class="row">
    <div class="span12">
      <div id="tab" class="btn-group" data-toggle="buttons-radio">
        <% Country.all.each do |country| %>
        <a href="#<%=country.name %>" class="btn btn-large btn-info active" data-toggle="tab"><%= country.name %></a>
        <% end %>
      </div>

      <div class="tab-content">
        <div class="tab-pane active" id="Rwanda">
          <br>
          <p class="lead">Rwanda</p>
          <div class="dropdown">
            <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="#" href="/page.html">
              Sort<span class="caret"></span>
            </a>
            <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu"> 
              <li class="dropdown-submenu">
                <% Country.find_by(name:"Rwanda").provinces.each do |province| %>
                <a tabindex="-1" href="#"><%= province.name %></a>
                <ul class="dropdown-menu">
                  <li><a tabindex="-1" href="#">Districts</a></li>
                  <% province.districts.each do |district| %>
                  <li><a href="/student_infos?district_id=<%= district.id %>"><%= district.name %></a></li>
                  <% end %>
                </ul>
                <% end %>
              </li>

              <li class="divider"></li>
              <li class="dropdown-submenu">
                <% ProgramCategory.all.each do |program| %>
                <a tabindex="-1" href="/student_infos?program_id=<%= program.id %>"><%= program.name %></a>
                <ul class="dropdown-menu">
                  <li><a tabindex="-1" href="#">Courses</a></li>
                  <% program.courses.each do |course| %>
                  <li><a href="/student_infos?course_id=<%= course.id %>"><%= course.name %></a></li>
                  <% end %>
                </ul>
                <% end %>
              </li>
            </ul>
          </div>

          <div class="span7">   
            <div class="widget stacked widget-table action-table">       
              <div class="widget-header">
                <i class="icon-th-list"></i>
                <h3>Table</h3>
              </div> <!-- /widget-header -->

              <div class="widget-content">

                <table class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th>Stend Name</th>
                      <th>Description</th>
                      <th class="td-actions">Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @student_infos.each do |studentInfo| %>
                    <tr>
                      <td><%= studentInfo.student.first_name %> <%= studentInfo.student.last_name %></td>
                      <td>S/he is enrolling in <%= studentInfo.program_category.name %> under <%= studentInfo.course.name %> course</td>
                      <td >
                       <% if studentInfo.status == true%>
                        <i style="color: green;">Approved</i>
                       <% else %>
                        <i style="color: red;">Pending</i>
                       <% end %>
                      </td>
                    </tr>
                    <% end %>
                  </tbody>
                </table>  
              </div> <!-- /widget-content -->
            </div> <!-- /widget -->
          </div>
        </div>
        <% Country.all.each do |country| %>
        <% if country.name != "Rwanda" %>
        <div class="tab-pane" id="<%= country.name %>">
          <br>
          <p class="lead"><%= country.name %></p>
          <div class="span7">   
            <div class="widget stacked widget-table action-table">       
              <%= form_tag student_infos_path, :method => 'get' do %>
                <p>
                  <%= text_field_tag :search, params[:search], placeholder: "city..", required:"required"%>
                  <%= submit_tag "Search", :name => nil %>
                </p>
              <% end %>
              <div class="widget-header">
                <i class="icon-th-list"></i>
              </div> <!-- /widget-header -->

              <div class="widget-content">

                <table class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th>Stend Name</th>
                      <th>Description</th>
                      <th class="td-actions">Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @int_student_infos.each do |studentInfo| %>
                    <tr>
                      <td><%= studentInfo.student.first_name %> <%= studentInfo.student.last_name %></td>
                      <td>He is enrolling in <%= studentInfo.program_category.name %> under <%= studentInfo.course.name %> course</td>
                      <td >
                        <%= link_to "Approve", "/student_infos?appr=#{studentInfo.id}" %>
                      </td>
                    </tr>
                    <% end %>
                  </tbody>
                </table>  
              </div> <!-- /widget-content -->
            </div> <!-- /widget -->
          </div>
        </div>
        <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
<% end %>